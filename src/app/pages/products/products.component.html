<div class="page-container">
  <div class="page-header">
    <h1>Products</h1>
    <span class="badge">Total: <strong>{{ filteredProducts.length }}</strong> records</span>
  </div>

  <div class="filters-panel">
    <div class="filter-group">
      <label>Search Name</label>
      <input type="text" [(ngModel)]="searchName" (ngModelChange)="applyFilters()" placeholder="Search products..." />
    </div>
    <div class="filter-group">
      <label>Category</label>
      <select [(ngModel)]="filterCategory" (ngModelChange)="applyFilters()">
        <option value="">All Categories</option>
        <option *ngFor="let c of categories" [value]="c">{{ c }}</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Lifecycle Status</label>
      <select [(ngModel)]="filterStatus" (ngModelChange)="applyFilters()">
        <option value="">All Statuses</option>
        <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
      </select>
    </div>
    <button class="btn-clear" (click)="applyFilters()">Apply Filters</button>
  </div>

  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Loading products...</p>
  </div>

  <div *ngIf="!loading" class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th class="col-expand"></th>
          <th>ID</th>
          <th>Name</th>
          <th>Category</th>
          <th>Process Node (nm)</th>
          <th>Package Type</th>
          <th>Unit Price (USD)</th>
          <th>Lifecycle Status</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let p of pagedProducts">
          <tr [class.expanded-row]="expandedProductId === p.productId">
            <td class="col-expand">
              <button class="btn-expand" (click)="toggleDetails(p)" [title]="expandedProductId === p.productId ? 'Hide details' : 'Show details'">
                {{ expandedProductId === p.productId ? '‚ñæ' : '‚ñ∏' }}
              </button>
            </td>
            <td>{{ p.productId }}</td>
            <td class="name-cell">{{ p.productName }}</td>
            <td><span class="tag">{{ p.productCategory }}</span></td>
            <td class="number-cell">{{ p.processNodeNm }}</td>
            <td>{{ p.packageType }}</td>
            <td class="number-cell">${{ p.unitPriceUsd | number:'1.2-2' }}</td>
            <td>
              <span class="status-badge" [class.active]="p.lifecycleStatus === 'Active'"
                    [class.eol]="p.lifecycleStatus === 'EOL'"
                    [class.nrnd]="p.lifecycleStatus === 'NRND'">
                {{ p.lifecycleStatus }}
              </span>
            </td>
          </tr>
          <!-- Expanded Detail Row -->
          <tr *ngIf="expandedProductId === p.productId" class="detail-row">
            <td colspan="8">
              <div class="detail-panel">
                <!-- Description Section -->
                <div class="detail-section">
                  <h3>üìã Product Description</h3>
                  <div *ngIf="descriptionLoading" class="detail-loading">
                    <div class="spinner-small"></div>
                    <span>Loading description...</span>
                  </div>
                  <p *ngIf="!descriptionLoading && productDescription" class="description-text">{{ productDescription }}</p>
                </div>

                <!-- Documents Section -->
                <div class="detail-section">
                  <h3>üìÑ Product Documents</h3>
                  <div *ngIf="documentsLoading" class="detail-loading">
                    <div class="spinner-small"></div>
                    <span>Loading documents...</span>
                  </div>
                  <div *ngIf="!documentsLoading && productDocuments.length > 0" class="documents-list">
                    <div class="document-card" *ngFor="let doc of productDocuments">
                      <div class="document-info">
                        <span class="document-type-badge">{{ doc.documentType }}</span>
                        <span class="document-name">{{ doc.fileName }}</span>
                      </div>
                      <div class="document-actions">
                        <button class="btn-view" (click)="viewDocument(doc)" title="View document in browser">
                          üëÅ View
                        </button>
                        <button class="btn-download" (click)="downloadDocument(doc)" title="Download document">
                          ‚¨á Download
                        </button>
                      </div>
                    </div>
                  </div>
                  <p *ngIf="!documentsLoading && productDocuments.length === 0" class="no-docs">No documents available for this product.</p>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
        <tr *ngIf="filteredProducts.length === 0">
          <td colspan="8" class="empty-row">No products match the current filters.</td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div *ngIf="filteredProducts.length > 0" class="pagination-bar">
      <div class="pagination-info">
        Showing {{ (currentPage - 1) * pageSize + 1 }}‚Äì{{ currentPage * pageSize < totalRecords ? currentPage * pageSize : totalRecords }}
        of <span class="total-count">{{ totalRecords }}</span> records
      </div>
      <div class="pagination-controls">
        <button (click)="goToPage(1)" [disabled]="currentPage === 1">&laquo;</button>
        <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">&lsaquo;</button>
        <button *ngFor="let p of pageNumbers" (click)="goToPage(p)" [class.active]="p === currentPage">{{ p }}</button>
        <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">&rsaquo;</button>
        <button (click)="goToPage(totalPages)" [disabled]="currentPage === totalPages">&raquo;</button>
      </div>
      <div class="pagination-size">
        <label>Page size</label>
        <select [(ngModel)]="pageSize" (ngModelChange)="onPageSizeChange()">
          <option *ngFor="let s of pageSizeOptions" [value]="s">{{ s }}</option>
        </select>
      </div>
    </div>
  </div>
</div>
